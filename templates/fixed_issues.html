{% extends "base.html" %}
{% block content %}
  <div class="container">
    <h1><i class="fas fa-archive"></i> Fixed Issues Archive</h1>

    <form method="get" class="row g-2 mb-3">
      <div class="col-auto">
        <input class="form-control" name="category" placeholder="Category" value="{{ request.args.get('category','') }}">
      </div>
      <div class="col-auto">
        <input class="form-control" name="priority" placeholder="Priority" value="{{ request.args.get('priority','') }}">
      </div>
      <div class="col-auto">
        <input class="form-control" name="fixed_by" placeholder="Fixed by" value="{{ request.args.get('fixed_by','') }}">
      </div>
      <div class="col-auto">
        <button class="btn btn-primary" type="submit">Filter</button>
      </div>
      <div class="col-auto">
        <a class="btn btn-outline-secondary" href="{{ url_for('export_fixed_issues_csv') }}">Export CSV</a>
      </div>
    </form>

    {% if fixed_issues %}
      <div class="card">
        <div class="card-header">
          <i class="fas fa-list"></i> Fixed Issues
        </div>
        <div class="card-body">
          <div class="list-group">
            {% for f in fixed_issues %}
              <div class="list-group-item d-flex justify-content-between align-items-start">
                <div class="flex-grow-1">
                  <h5 class="mb-2">{{ f.title }}</h5>
                  <p class="mb-2 text-muted">{{ f.description[:200] }}{% if f.description|length > 200 %}...{% endif %}</p>

                  <div class="d-flex gap-2 flex-wrap">
                    <span class="badge badge-primary">{{ f.category }}</span>
                    <span class="badge badge-secondary">{{ f.priority }}</span>
                    <small class="text-muted">Fixed by {{ f.fixed_by or 'admin' }} at {{ f.fixed_at.strftime('%Y-%m-%d %H:%M') }}</small>
                  </div>
                </div>

                <div class="text-end ms-3">
                  {% if f.ticket_id %}
                    <a class="btn btn-sm btn-outline-secondary" href="/ticket/{{ f.ticket_id }}">
                      <i class="fas fa-link"></i> Original
                    </a>
                  {% endif %}
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
      </div>
    {% else %}
      <div class="alert alert-info">
        No fixed issues yet. This archive will list tickets that were marked as fixed.
      </div>
    {% endif %}

    <div class="mt-3">
      <a class="btn btn-outline-secondary" href="{{ url_for('admin_index') }}">Back to Admin</a>
    </div>
  </div>
{% endblock %}
